#include<stdio.h>
#include "draw.h"
#include "udp.h"

#define DRAW_MSG_SIZE 7 // 3 bytes for color (r, g, b) 2 bytes for (x1,y1), 2 bytes for (x2,y2) 

unsigned char msg[DRAW_MSG_SIZE];

typedef struct {
	unsigned char R;
	unsigned char G;
	unsigned char B;
} pixel_rgb_t;

// VGA Mode-13H palette (total of 256 colors)
pixel_rgb_t palette[] = {
	{  0,  0,  0}, {  0,  0,170}, {  0,170,  0}, {  0,170,170}, {170,  0,  0}, {170,  0,170}, {170, 85,  0}, {170,170,170},
	{ 85, 85, 85}, { 85, 85,255}, { 85,255, 85}, { 85,255,255}, {255, 85, 85}, {255, 85,255}, {255,255, 85}, {255,255,255}, 
	{  0,  0,  0}, { 20, 20, 20}, { 32, 32, 32}, { 44, 44, 44}, { 56, 56, 56}, { 68, 68, 68}, { 80, 80, 80}, { 97, 97, 97}, 
	{113,113,113}, {129,129,129}, {145,145,145}, {161,161,161}, {182,182,182}, {202,202,202}, {226,226,226}, {255,255,255}, 
	{  0,  0,255}, { 64,  0,255}, {125,  0,255}, {190,  0,255}, {255,  0,255}, {255,  0,190}, {255,  0,125}, {255,  0, 64}, 
	{255,  0,  0}, {255, 64,  0}, {255,125,  0}, {255,190,  0}, {255,255,  0}, {190,255,  0}, {125,255,  0}, { 64,255,  0}, 
	{  0,255,  0}, {  0,255, 64}, {  0,255,125}, {  0,255,190}, {  0,255,255}, {  0,190,255}, {  0,125,255}, {  0, 64,255}, 
	{125,125,255}, {157,125,255}, {190,125,255}, {222,125,255}, {255,125,255}, {255,125,222}, {255,125,190}, {255,125,157}, 
	{255,125,125}, {255,157,125}, {255,190,125}, {255,222,125}, {255,255,125}, {222,255,125}, {190,255,125}, {157,255,125}, 
	{125,255,125}, {125,255,157}, {125,255,190}, {125,255,222}, {125,255,255}, {125,222,255}, {125,190,255}, {125,157,255}, 
	{182,182,255}, {198,182,255}, {218,182,255}, {234,182,255}, {255,182,255}, {255,182,234}, {255,182,218}, {255,182,198}, 
	{255,182,182}, {255,198,182}, {255,218,182}, {255,234,182}, {255,255,182}, {234,255,182}, {218,255,182}, {198,255,182}, 
	{182,255,182}, {182,255,198}, {182,255,218}, {182,255,234}, {182,255,255}, {182,234,255}, {182,218,255}, {182,198,255}, 
	{  0,  0,113}, { 28,  0,113}, { 56,  0,113}, { 85,  0,113}, {113,  0,113}, {113,  0, 85}, {113,  0, 56}, {113,  0, 28}, 
	{113,  0,  0}, {113, 28,  0}, {113, 56,  0}, {113, 85,  0}, {113,113,  0}, { 85,113,  0}, { 56,113,  0}, { 28,113,  0}, 
	{  0,113,  0}, {  0,113, 28}, {  0,113, 56}, {  0,113, 85}, {  0,113,113}, {  0, 85,113}, {  0, 56,113}, {  0, 28,113}, 
	{ 56, 56,113}, { 68, 56,113}, { 85, 56,113}, { 97, 56,113}, {113, 56,113}, {113, 56, 97}, {113, 56, 85}, {113, 56, 68}, 
	{113, 56, 56}, {113, 68, 56}, {113, 85, 56}, {113, 97, 56}, {113,113, 56}, { 97,113, 56}, { 85,113, 56}, { 68,113, 56}, 
	{ 56,113, 56}, { 56,113, 68}, { 56,113, 85}, { 56,113, 97}, { 56,113,113}, { 56, 97,113}, { 56, 85,113}, { 56, 68,113}, 
	{ 80, 80,113}, { 89, 80,113}, { 97, 80,113}, {105, 80,113}, {113, 80,113}, {113, 80,105}, {113, 80, 97}, {113, 80, 89}, 
	{113, 80, 80}, {113, 89, 80}, {113, 97, 80}, {113,105, 80}, {113,113, 80}, {105,113, 80}, { 97,113, 80}, { 89,113, 80}, 
	{ 80,113, 80}, { 80,113, 89}, { 80,113, 97}, { 80,113,105}, { 80,113,113}, { 80,105,113}, { 80, 97,113}, { 80, 89,113}, 
	{  0,  0, 64}, { 16,  0, 64}, { 32,  0, 64}, { 48,  0, 64}, { 64,  0, 64}, { 64,  0, 48}, { 64,  0, 32}, { 64,  0, 16}, 
	{ 64,  0,  0}, { 64, 16,  0}, { 64, 32,  0}, { 64, 48,  0}, { 64, 64,  0}, { 48, 64,  0}, { 32, 64,  0}, { 16, 64,  0}, 
	{  0, 64,  0}, {  0, 64, 16}, {  0, 64, 32}, {  0, 64, 48}, {  0, 64, 64}, {  0, 48, 64}, {  0, 32, 64}, {  0, 16, 64}, 
	{ 32, 32, 64}, { 40, 32, 64}, { 48, 32, 64}, { 56, 32, 64}, { 64, 32, 64}, { 64, 32, 56}, { 64, 32, 48}, { 64, 32, 40}, 
	{ 64, 32, 32}, { 64, 40, 32}, { 64, 48, 32}, { 64, 56, 32}, { 64, 64, 32}, { 56, 64, 32}, { 48, 64, 32}, { 40, 64, 32}, 
	{ 32, 64, 32}, { 32, 64, 40}, { 32, 64, 48}, { 32, 64, 56}, { 32, 64, 64}, { 32, 56, 64}, { 32, 48, 64}, { 32, 40, 64}, 
	{ 44, 44, 64}, { 48, 44, 64}, { 52, 44, 64}, { 60, 44, 64}, { 64, 44, 64}, { 64, 44, 60}, { 64, 44, 52}, { 64, 44, 48}, 
	{ 64, 44, 44}, { 64, 48, 44}, { 64, 52, 44}, { 64, 60, 44}, { 64, 64, 44}, { 60, 64, 44}, { 52, 64, 44}, { 48, 64, 44}, 
	{ 44, 64, 44}, { 44, 64, 48}, { 44, 64, 52}, { 44, 64, 60}, { 44, 64, 64}, { 44, 60, 64}, { 44, 52, 64}, { 44, 48, 64}, 
	{  0,  0,  0}, {  0,  0,  0}, {  0,  0,  0}, {  0,  0,  0}, {  0,  0,  0}, {  0,  0,  0}, {  0,  0,  0}, {  0,  0,  0}
};


void DRAW_init(void)
{
  UDP_init();
} /* DRAW_init */


void DRAW_terminate(void)
{
  UDP_terminate();
} /* DRAW_terminate */


void DRAW_rectangle(unsigned char color, unsigned char x, unsigned char y, unsigned char width, unsigned char height)
{
	msg[0] = palette[color].R;
	msg[1] = palette[color].G;
	msg[2] = palette[color].B;
	msg[3] = x;
	msg[4] = y;
	msg[5] = x + width;
	msg[6] = y + height;

  UDP_send(msg, DRAW_MSG_SIZE);
} /* DRAW_rectangle */


void DRAW_pixel(unsigned char color, unsigned char x, unsigned char y)
{
  DRAW_rectangle(color, x, y, 1, 1); // a pixel is a 1X1 sized rectangle
} /* DRAW_pixel */


void DRAW_bitmap(unsigned char *bitmap, unsigned char x, unsigned char y, unsigned char width, unsigned char height)
{
  unsigned char col, row;
  
  for (row = 0; row < height; row++) {
    for (col = 0; col < width; col++) {
      DRAW_pixel(*bitmap, x + col, y + row);
  	  bitmap++;
    }
  }
} /* DRAW_bitmap */
